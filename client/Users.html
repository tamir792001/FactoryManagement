<!DOCTYPE html>

<html>

<head>
    <title>Factory Users</title>
</head>
<script>
function fillTable(users)
{
    const tbody = document.getElementById('tbody');
    users.forEach((user,index) => {
        const row = document.createElement('tr')
        row.id = `user${index}row`
        tbody.appendChild(row);

        const usernameCell = document.createElement('td');
        usernameCell.innerText = user.fullname

        const maxActionsCell = document.createElement('td');
        maxActionsCell.innerText = user.MaxActions

        const actionsMadeCell = document.createElement('td');
        actionsMadeCell.innerText = user.actionsMade ? user.actionsMade : 0

        row.append(usernameCell,maxActionsCell,actionsMadeCell)

    })
}
async function getAllUsers(){
    document.getElementById('loggedUser').innerHTML = `Hello, ${JSON.parse(sessionStorage.getItem('userInformation'))?.fullname}`
    const resp = await fetch('http://localhost:5000/users', 
                            {headers :{"x-access-token" : sessionStorage.getItem("token"),
                                       "userInformation" : sessionStorage.getItem("userInformation")}})
    const users = await resp.json()
    if (!Object.keys(users).includes("error"))
    {  
        fillTable(users)
    }
    else
    {
        tokenNotValid()
    }
    
}
function tokenNotValid()
{
    alert('UNAUTHORIZED USER\nPlease make sure to log in correctly')
    document.location.href = "login.html"
}
function logout(){
    sessionStorage.clear()
    document.location.href = 'login.html'
}
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
<body onload="getAllUsers()" class="container">
    <div>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <a class="navbar-brand" href="factory.html">Factory</a>
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="departments.html">Departments</a></li>
                <li class="nav-item"><a class="nav-link" href="employees.html">Employees</a></li>
                <li class="nav-item"><a class="nav-link" href="shifts.html">Shifts</a></li>
            </ul>
        </nav>
    </div>
<h2 id="loggedUser" >Hello, Guest</h2>
<input type="button" value="Log Out" class="btn btn-primary" onclick="logout()">
<section>
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Usernames</th>
                <th scope="col">Maximum Actions Allowed</th>
                <th scope="col">Actions Made</th>
            </tr>
        </thead>
        <tbody id="tbody">

        </tbody>
    </table>
</section>
</body>
</html>